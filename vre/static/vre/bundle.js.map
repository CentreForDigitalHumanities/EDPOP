{"version":3,"sources":["main.js","additions/additions-to-collections.js","alert/alert.view.js","annotation/annotation.edit.view.js","annotation/annotation.model.js","collection/collection.model.js","collection/collection.view.js","field/field.model.js","field/field.view.js","field/record.field.view.js","globals/myCollections.js","globals/recordDetailModal.js","globals/templates.js","globals/variables.js","group/group.menu.view.js","group/group.model.js","search/search.model.js","search/search.view.js","record/record.detail.view.js","record/record.list.item.view.js","record/record.list.view.js","record/record.model.js","select-source/select-source.view.js","utils/api.model.js","utils/generic-functions.js","utils/lazy.template.view.js"],"names":["GlobalVariables","records","Records","recordsList","RecordListView","collection","allGroups","ResearchGroups","results","SearchResults","searchView","SearchView","id","_","identity","Backbone","sync","overArgs","addCSRFToken","VRERouter","Router","extend","routes","showDatabase","render","$el","appendTo","first","show","advancedSearchView","AdvancedSearchView","listenTo","fill","popover","JST","hide","currentVRECollection","myCollections","get","getRecords","remove","insertAfter","source","prepareCollectionViews","recordDetailModal","RecordDetailView","dropDown","SelectSourceView","each","i","element","prop","Handlebars","compile","html","compat","modal","allCollections","VRECollections","fetch","then","history","start","pushState","root","mine","myGroups","groupMenu","GroupMenuView","length","on","router","AdditionsToCollections","Model","url","AlertView","LazyTemplateView","ease","delay","className","templateName","attributes","role","initialize","options","assign","pick","addClass","getLevelClass","template","animate","complete","followUp","bind","animateOut","animateIn","partial","wrapComplete","level","AnnotationEditView","tagName","events","cid","model","submit","event","preventDefault","$","index","set","name","val","trigger","reset","Annotations","APICollection","FlatAnnotations","comparator","item","key","modelId","group","models","underlying","record","getAnnotations","forEach","toFlat","markedGroups","Collection","markGroup","debounce","fromFlat","annotation","isNew","hasChanged","listenToOnce","save","silent","groupId","groupName","content","existing","map","filter","replacements","value","obsolete","differenceBy","add","merge","flatAnnotation","flat","recordId","flatPerGroup","groupBy","newContent","findWhere","managing_group","fromPairs","invokeMap","VRECollection","APIModel","query","params","collection__id","VRECollectionView","shownCollections","clone","toJSON","select2","setRecord","clear","activateButton","removeClass","submitForm","selected_records","push","items","selected","selected_collections","records_and_collections","showSuccess","showError","response","feedbackString","concat","showAlert","responseJSON","error","message","alert","prependTo","el","Field","idAttribute","FlatFields","has","flow","FieldView","edit","RecordFieldsBaseView","rows","createRow","insertRow","row","indexOf","$tbody","append","splice","children","eq","before","RecordFieldsView","title","RecordAnnotationsView","prototype","call","editable","editTarget","preExisting","newRow","oldRow","cancel","editEmpty","editRow","staticRow","after","GroupMenuItemView","select","activate","$header","$list","resetItems","includes","savedId","localStorage","getItem","savedGroup","setItem","myResearchGroups","total_results","parse","result_list","showPending","text","showIdle","submitSearch","startRecord","myElement","searchTerm","searchPromise","search","always","firstSearch","document","contains","feedback","nextSearch","fillText","fillIn","target","textContent","slice","$title","$body","$footer","vreCollectionsSelect","setModel","annotationsView","off","fieldsView","uriText","getElementById","href","prepend","load","currentIndex","findIndex","nextIndex","nextModel","at","SelectableView","toggle","checked","check","$checkbox","uncheck","SelectAllView","RecordListItemView","display","checkedCount","addItem","showSelectAll","renderItems","empty","checkOne","uncheckOne","loadMore","selectAllView","checkAll","uncheckAll","allChecked","notAllChecked","Record","urlRoot","annotations","record__id","collections","urlParts","fetchOptions","omit","join","objectAsUrlParams","canonicalSort","object","entries","ajaxOptions","defaultsDeep","headers","Cookies","canonicalOrder","View","context"],"mappings":"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","file":"bundle.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport Backbone from 'backbone';\nimport Handlebars from 'handlebars';\nimport { Records } from './record/record.model';\nimport { RecordListView } from './record/record.list.view';\nimport { RecordDetailView } from './record/record.detail.view';\nimport { VRECollections } from './collection/collection.model';\nimport { ResearchGroups } from './group/group.model';\nimport { GroupMenuView } from './group/group.menu.view';\nimport { SearchResults } from './search/search.model';\nimport { SearchView, AdvancedSearchView } from './search/search.view';\nimport { SelectSourceView } from './select-source/select-source.view';\nimport { addCSRFToken } from './utils/generic-functions';\n//import { myCollections } from './globals/myCollections';\nimport { JST } from './globals/templates';\nimport { GlobalVariables } from './globals/variables';\n\n\n// Global variables\nGlobalVariables.records = new Records();\nGlobalVariables.recordsList = new RecordListView({collection: GlobalVariables.records});\nGlobalVariables.allGroups = new ResearchGroups();\nGlobalVariables.results = new SearchResults();\nGlobalVariables.searchView  = new SearchView();\n\n\n// Override Backbone.sync so it always includes the CSRF token in requests.\n(function() {\n    var id = _.identity;\n    Backbone.sync = _.overArgs(Backbone.sync, [id, id, addCSRFToken]);\n}());\n\nvar VRERouter = Backbone.Router.extend({\n    routes: {\n        ':id/': 'showDatabase',\n    },\n    showDatabase: function(id) {\n        GlobalVariables.searchView.render();\n        GlobalVariables.searchView.$el.appendTo($('.page-header').first());\n        // The if-condition is a bit of a hack, which can go away when we\n        // convert to client side routing entirely.\n        if (id==\"hpb\") {\n            $('#HPB-info').show();\n            var advancedSearchView = new AdvancedSearchView();\n            advancedSearchView.render();\n            GlobalVariables.searchView.listenTo(advancedSearchView, 'fill', GlobalVariables.searchView.fill);\n            $('#search-info').show();\n            $('#search-info').popover({\n                'html': true,\n                'content': JST['hpb-search-info'](),\n                'container': 'body',\n                'placement': 'left'\n            });\n        }\n        else {\n            // We are not on the HPB search page, so display the\n            // records in the current collection.\n            $('#HPB-info').hide();\n            GlobalVariables.currentVRECollection = GlobalVariables.myCollections.get(id);\n            GlobalVariables.records = GlobalVariables.currentVRECollection.getRecords();\n            GlobalVariables.recordsList.remove();\n            GlobalVariables.recordsList = new RecordListView({collection: GlobalVariables.records});\n            GlobalVariables.recordsList.render().$el.insertAfter($('.page-header'));\n        }\n        GlobalVariables.searchView.source = id;\n    },\n});\n\nfunction prepareCollectionViews() {\n    GlobalVariables.recordDetailModal = new RecordDetailView();\n    GlobalVariables.dropDown = new SelectSourceView({collection: GlobalVariables.myCollections});\n    GlobalVariables.dropDown.$el.appendTo($('.nav').first());\n}\n\n$(function() {\n    $('script[type=\"text/x-handlebars-template\"]').each(function(i, element) {\n        var $el = $(element);\n        JST[$el.prop('id')] = Handlebars.compile($el.html(), {compat: true});\n    });\n    $('#result_detail').modal({show: false});\n    // We fetch the collections and ensure that we have them before we handle\n    // the route, because VRERouter.showCollection depends on them being\n    // available. This is something we can definitely improve upon.\n    var allCollections = new VRECollections();\n    allCollections.fetch().then(function() {\n        Backbone.history.start({\n            pushState: true,  // this enables matching the path of the URL hashchange\n            root: '/vre/',\n        });\n    });\n    GlobalVariables.myCollections = VRECollections.mine();\n    GlobalVariables.allGroups.fetch();\n    var myGroups = ResearchGroups.mine();\n    GlobalVariables.groupMenu = new GroupMenuView({collection: myGroups});\n    if (GlobalVariables.myCollections.length) {\n        prepareCollectionViews();\n    } else {\n        GlobalVariables.myCollections.on(\"sync\", prepareCollectionViews);\n    }\n    var router = new VRERouter();\n});\n","import Backbone from 'backbone';\n\nexport var AdditionsToCollections = Backbone.Model.extend({\n    url: '/vre/add-selection',\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\n\n/**\n * Reusable alert view. Meant to be displayed once and then discarded.\n *\n * The methods with a `complete` parameter accept three types of values:\n *\n *  1. any function, which will be executed after the animation completes;\n *  2. a string, which should be the name of a method of the alert view;\n *  3. undefined, in which case nothing is done after the animation completes.\n */\nexport var AlertView = LazyTemplateView.extend({\n    ease: 500,\n    delay: 2000,\n    className: 'alert alert-dismissible',\n    templateName: 'alert-view',\n    attributes: {\n        role: 'alert',\n    },\n    initialize: function(options) {\n        _.assign(this, _.pick(options, ['level', 'message', 'ease', 'delay']));\n    },\n    render: function() {\n        this.$el.addClass(this.getLevelClass()).html(this.template(this));\n        return this;\n    },\n    // Show and hide automatically, then execute `complete`.\n    animate: function(complete) {\n        var followUp = _.bind(this.animateOut, this, complete);\n        // The _.partial(...) below is a shorthand for _.bind(function() {\n        //     _.delay(followUp, this.delay);\n        // }, this), where _.delay in turn is a shorthand for setTimeout.\n        return this.animateIn(_.partial(_.delay, followUp, this.delay));\n    },\n    // Show with ease and then execute `complete`.\n    animateIn: function(complete) {\n        this.$el.show(this.ease, this.wrapComplete(complete));\n        return this;\n    },\n    // Hide with ease and then execute `complete`.\n    animateOut: function(complete) {\n        this.$el.hide(this.ease, this.wrapComplete(complete));\n        return this;\n    },\n    getLevelClass: function() {\n        return 'alert-' + this.level;\n    },\n    // Utility function that enables the \"string as method name\" magic.\n    wrapComplete: function(complete) {\n        return this[complete] && this[complete].bind(this) || complete;\n    },\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\n\nexport var AnnotationEditView = LazyTemplateView.extend({\n    tagName: 'tr',\n    className: 'form-inline',\n    templateName: 'field-list-item-edit',\n    events: {\n        'submit': 'submit',\n        'reset': 'reset',\n    },\n    initialize: function(options) {\n        _.assign(this, _.pick(options, ['existing']));\n    },\n    render: function() {\n        this.$el.html(this.template(\n            _.extend({cid: this.cid}, this.model.attributes)\n        ));\n        return this;\n    },\n    submit: function(event) {\n        event.preventDefault();\n        var model = this.model;\n        this.$('input').each(function(index, element) {\n            model.set(this.name, $(this).val());\n        });\n        this.trigger('save', this);\n    },\n    reset: function(event) {\n        event.preventDefault();\n        this.trigger('cancel', this);\n    },\n});","import  Backbone from 'backbone';\nimport { APIModel, APICollection } from '../utils/api.model';\nimport { canonicalSort } from '../utils/generic-functions';\nimport { GlobalVariables } from '../globals/variables';\n\nexport var Annotations = APICollection.extend({\n    url: '/vre/api/annotations',\n});\n\nexport var FlatAnnotations = APICollection.extend({\n    // comparator: can be set to keep this sorted\n    // How to uniquely identify a field annotation.\n    comparator: function(item) {\n        return canonicalSort(item.attributes.key);\n    },\n    modelId: function(attributes) {\n        return attributes.key + ':' + attributes.group;\n    },\n    initialize: function(models, options) {\n        _.assign(this, _.pick(options, ['record']));\n        this.underlying = this.record.getAnnotations();\n        this.underlying.forEach(this.toFlat.bind(this));\n        this.markedGroups = new Backbone.Collection([]);\n        this.listenTo(this.underlying, 'add change:content', this.toFlat);\n        this.on('add change:value', this.markGroup);\n        this.markedGroups.on('add', _.debounce(this.fromFlat), this);\n        // this.listenTo(this.underlying, 'remove', TODO);\n        // this.on('remove', TODO);\n    },\n    // translate the official representation to the flat one\n    toFlat: function(annotation) {\n        if (annotation.isNew() || annotation.hasChanged()) {\n            // Store the annotation either immediately or on record save.\n            if (this.record.isNew()) {\n                this.listenToOnce(annotation, 'change:record', function() {\n                    annotation.save(null, {silent: true});\n                });\n            } else annotation.save(null, {silent: true});\n        }\n        var id = annotation.id,\n            groupId = annotation.get('managing_group'),\n            groupName = GlobalVariables.allGroups.get(groupId).get('name'),\n            content = annotation.get('content'),\n            existing = _.map(this.filter({group: groupName}), 'attributes'),\n            replacements = _.map(content, function(value, key) {\n                return {id: id, key: key, value: value, group: groupName};\n            }),\n            obsolete = _.differenceBy(existing, replacements, this.modelId);\n        // After the next two lines, this.models will be up-to-date and\n        // appropriate events will have been triggered.\n        this.remove(obsolete);\n        this.add(replacements, {merge: true});\n    },\n    markGroup: function(flatAnnotation) {\n        this.markedGroups.add({id: flatAnnotation.get('group')});\n    },\n    // translate the flat representation to the official one, save immediately\n    fromFlat: function() {\n        var flat = this,\n            record = flat.record,\n            recordId = record.id,\n            flatPerGroup = flat.groupBy('group');\n        var newContent = flat.markedGroups.map('id').map(function(groupName) {\n            var groupId = GlobalVariables.allGroups.findWhere({name: groupName}).id,\n                existing = flat.underlying.findWhere({managing_group: groupId}),\n                id = existing && existing.id,\n                content = _(flatPerGroup[groupName]).map(function(model) {\n                    return [model.get('key'), model.get('value')];\n                }).fromPairs().value();\n            return {\n                id: id,\n                record: recordId,\n                managing_group: groupId,\n                content: content,\n            };\n        });\n        // At least one annotation exists, so now is the time to ensure\n        // the VRE knows the record.\n        if (record.isNew()) record.save().then(function() {\n            _.invokeMap(flat.underlying.models, 'set', 'record', record.id);\n        });\n        flat.underlying.add(newContent, {merge: true});\n        flat.markedGroups.reset();\n    },\n});","//import Backbone from 'backbone';\nimport { APIModel, APICollection } from '../utils/api.model'\nimport { Records } from '../record/record.model.js';\n\n/**\n * Representation of a single VRE collection.\n */\nexport var VRECollection = APIModel.extend({\n    getRecords: function() {\n        if (!this.records) {\n            var records = this.records = new Records();\n            records.query({\n                params: {collection__id: this.id},\n            }).then(function() {\n                records.trigger('complete');\n            });\n        }\n        return records;\n    },\n});\n\nexport var VRECollections = APICollection.extend({\n    url: '/vre/api/collections',\n    model: VRECollection,\n}, {\n    /**\n     * Class method for retrieving only the collections the user can manage.\n     */\n    mine: function() {\n        var myCollections = new VRECollections();\n        myCollections.fetch({url: myCollections.url + '/mine'});\n        return myCollections;\n    },\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\nimport { AlertView } from '../alert/alert.view';\nimport { AdditionsToCollections } from '../additions/additions-to-collections';\nimport { GlobalVariables } from '../globals/variables';\n\n\nexport var VRECollectionView = LazyTemplateView.extend({\n    templateName: 'collection-selector',\n    events: {\n        'click button': 'submitForm',\n        'change select': 'activateButton',\n    },\n    render: function() {\n        var shownCollections = this.collection.clone();\n        shownCollections.remove(GlobalVariables.currentVRECollection);\n        this.$el.html(this.template({models: shownCollections.toJSON()}));\n        this.$('select').select2();\n        return this;\n    },\n    setRecord: function(model) {\n        this.model = model;\n        return this;\n    },\n    clear: function() {\n        this.$el.val(null).trigger('change');\n        return this;\n    },\n    activateButton: function(event) {\n        event.preventDefault();\n        if (this.$('select').val().length) {\n            this.$('button').removeClass(\"disabled\");\n        }\n        else {\n            this.$('button').addClass(\"disabled\");\n        }\n    },\n    submitForm: function(event) {\n        event.preventDefault();\n        var selected_records = [];\n        if (this.model) {\n            // adding to array as the api expects an array.\n            selected_records.push(this.model.toJSON());\n        }\n        else {\n            selected_records = _(recordsList.items).filter({selected: true}).invokeMap('model.toJSON').value();\n        }\n        var selected_collections = this.$('select').val();\n        var records_and_collections = new AdditionsToCollections({\n            'records': selected_records,\n            'collections': selected_collections,\n        });\n        records_and_collections.save().then(\n            this.showSuccess.bind(this),\n            this.showError.bind(this),\n        );\n    },\n    showSuccess: function(response) {\n        var feedbackString = '';\n        $.each(response, function(key, value) {\n            feedbackString = feedbackString.concat('Added ', value, ' record(s) to ', key, \". \");\n        });\n        this.showAlert('success', feedbackString);\n    },\n    showError: function(response) {\n        this.showAlert('warning', response.responseJSON.error);\n    },\n    showAlert: function(level, message) {\n        var alert = new AlertView({level: level, message: message});\n        alert.render().$el.prependTo(this.el);\n        alert.animate('remove');\n    },\n});","import Backbone from 'backbone';\nimport { canonicalSort } from '../utils/generic-functions';\n\n// A single field of a single record.\nexport var Field = Backbone.Model.extend({\n    idAttribute: 'key',\n});\n\n/**\n * This is an alternative, flat representation of the fields in a given\n * option.record. Its purpose is to be easier to represent and manage from\n * a view.\n *\n * normal: {id, uri, content}\n * flat alternative: [{key, value}]\n *\n * Note that we extend directly from Backbone.Collection rather than from\n * APICollection and that we don't set a URL. This is because we only talk\n * to the server through the underlying Record model.\n */\nexport var FlatFields = Backbone.Collection.extend({\n    model: Field,\n    comparator: function(item) {\n        return canonicalSort(item.attributes.key);\n    },\n    initialize: function(models, options) {\n        _.assign(this, _.pick(options, ['record']));\n        if (this.record.has('content')) this.set(this.toFlat(this.record));\n        // Do the above line again when the record changes.\n        this.listenTo(this.record, 'change', _.flow([this.toFlat, this.set]));\n    },\n    toFlat: function(record) {\n        return _.map(record.get('content'), function(value, key) {\n            return {key: key, value: value};\n        });\n    },\n});\n","import { LazyTemplateView } from '../utils/lazy.template.view';\n\n/**\n * Displays a single model from a FlatFields or FlatAnnotations collection.\n */\nexport var FieldView = LazyTemplateView.extend({\n    tagName: 'tr',\n    templateName: 'field-list-item',\n    events: {\n        'click': 'edit',\n    },\n    initialize: function(options) {\n        this.listenTo(this.model, 'change:value', this.render);\n    },\n    render: function() {\n        this.$el.html(this.template(this.model.attributes));\n        return this;\n    },\n    edit: function(event) {\n        this.trigger('edit', this.model);\n    },\n});","import  Backbone from 'backbone';\nimport { LazyTemplateView } from '../utils/lazy.template.view';\nimport { FieldView } from './field.view';\nimport { AnnotationEditView } from '../annotation/annotation.edit.view';\nimport { GlobalVariables } from '../globals/variables';\n\nvar RecordFieldsBaseView = LazyTemplateView.extend({\n    templateName: 'field-list',\n    initialize: function(options) {\n        this.rows = this.collection.map(this.createRow.bind(this));\n        this.listenTo(this.collection, 'add', this.insertRow);\n    },\n    createRow: function(model) {\n        var row = new FieldView({model: model});\n        row.on('edit', this.edit, this);\n        return row;\n    },\n    insertRow: function(model) {\n        var row = this.createRow(model),\n            rows = this.rows,\n            el = row.render().el,\n            index = this.collection.indexOf(model);\n        if (index >= rows.length) {\n            rows.push(row);\n            this.$tbody.append(el);\n        } else {\n            rows.splice(index, 0, row);\n            this.$tbody.children().eq(index).before(el);\n        }\n    },\n    render: function() {\n        this.$el.html(this.template(this));\n        this.$tbody = this.$('tbody');\n        this.$tbody.append(_(this.rows).invokeMap('render').map('el').value());\n        return this;\n    },\n});\n\nexport var RecordFieldsView = RecordFieldsBaseView.extend({\n    title: 'Original content',\n    edit: function(model) {\n        this.trigger('edit', model);\n    },\n});\n\nexport var RecordAnnotationsView = RecordFieldsBaseView.extend({\n    title: 'Annotations',\n    initialize: function(options) {\n        RecordFieldsBaseView.prototype.initialize.call(this, options);\n        this.editable = true;  // enables \"New field\" button\n    },\n    events: {\n        'click table + button': 'editEmpty',\n    },\n    edit: function(model) {\n        var group = GlobalVariables.groupMenu.model.get('name'),\n            editTarget = model.clone().set('group', group),\n            preExisting = this.collection.get(editTarget),\n            newRow;\n        if (preExisting) {\n            var index = this.collection.indexOf(preExisting),\n                oldRow = this.rows[index];\n            newRow = new AnnotationEditView({\n                model: preExisting,\n                existing: true,\n            });\n            this.rows.splice(index, 1, newRow);\n            oldRow.$el.before(newRow.render().el);\n            oldRow.remove();\n        } else {\n            newRow = new AnnotationEditView({model: editTarget});\n            this.rows.push(newRow);\n            this.$tbody.append(newRow.render().el);\n        }\n        newRow.on({cancel: this.cancel, save: this.save}, this);\n    },\n    editEmpty: function() {\n        this.edit(new Backbone.Model());\n    },\n    cancel: function(editRow) {\n        var staticRow, index = _.indexOf(this.rows, editRow);\n        if (editRow.existing) {\n            staticRow = this.createRow(editRow.model);\n            editRow.$el.after(staticRow.render().el);\n        }\n        editRow.remove();\n        this.rows.splice(index, 1, staticRow);\n    },\n    save: function(editRow) {\n        var model = editRow.model;\n        // first, remove the inline form\n        this.rows.splice(_.indexOf(this.rows, editRow), 1);\n        editRow.remove();\n        // then, add the model\n        if (editRow.existing) {\n            // re-insert if pre-existing, because .add (below) will not trigger\n            this.insertRow(model);\n        }\n        this.collection.add(model, {merge: true});\n    },\n});","import { VRECollections } from '../collection/collection.model';\n\nexport var myCollections = VRECollections.mine();\n","import { RecordDetailView } from '../record/record.detail.view';\n\nexport var recordDetailModal = new RecordDetailView();","export var JST = {};","export var GlobalVariables = {};","import { LazyTemplateView } from '../utils/lazy.template.view'\n\nexport var GroupMenuItemView = LazyTemplateView.extend({\n    tagName: 'li',\n    templateName: 'group-menu-item',\n    events: {\n        'click': 'select',\n    },\n    render: function() {\n        this.$el.html(this.template(this.model.attributes));\n        return this;\n    },\n    select: function(event) {\n        this.trigger('select', this.model);\n    },\n    activate: function(model) {\n        if (model === this.model) {\n            this.$el.addClass('active');\n        } else {\n            this.$el.removeClass('active');\n        }\n    },\n});\n\nexport var GroupMenuView = LazyTemplateView.extend({\n    el: '#vre-group-menu',\n    templateName: 'group-menu-header',\n    initialize: function(options) {\n        this.$header = this.$('.dropdown-toggle');\n        this.$list = this.$('.dropdown-menu');\n        this.items = [];\n        this.resetItems(this.collection);\n        this.listenTo(this.collection, 'update reset', this.resetItems);\n    },\n    resetItems: function(collection) {\n        _.invokeMap(this.items, 'remove');\n        this.items = this.collection.map(_.bind(function(group) {\n            var item = new GroupMenuItemView({model: group});\n            item.on('select', this.select, this);\n            item.listenTo(this, 'select', item.activate);\n            return item;\n        }, this));\n        this.$list.append(_(this.items).invokeMap('render').map('el').value());\n        if (!this.model || !this.collection.includes(this.model)) {\n            var savedId = localStorage.getItem('researchGroup');\n            if (savedId) {\n                var savedGroup = this.collection.get(savedId);\n                this.select(savedGroup);\n            }\n            else {\n                this.select(this.collection.first());\n            }\n        }\n    },\n    select: function(model) {\n        if (model === this.model) return;\n        this.model = model;\n        this.render();\n        this.trigger('select', model);\n        localStorage.setItem('researchGroup', model.attributes.id);\n    },\n    render: function() {\n        this.$header.html(this.template(this.model.attributes));\n    },\n});","import { APICollection } from '../utils/api.model';\n\nexport var ResearchGroups = APICollection.extend({\n    url: '/vre/api/researchgroups',\n}, {\n    /**\n     * Class method for retrieving only the research groups of the user.\n     */\n    mine: function() {\n        var myResearchGroups = new ResearchGroups();\n        myResearchGroups.fetch({url: myResearchGroups.url + '/mine'});\n        return myResearchGroups;\n    },\n});","import { Records } from '../record/record.model';\n\nexport var SearchResults = Records.extend({\n    url:'/vre/api/search',\n    total_results: 0,\n    parse: function(response) {\n        this.total_results = response.total_results;\n        return response.result_list;\n    }\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\nimport { AlertView } from '../alert/alert.view';\nimport { JST } from '../globals/templates';\nimport { GlobalVariables } from '../globals/variables';\n\nexport var SearchView = LazyTemplateView.extend({\n    templateName: \"search-view\",\n    events: {\n        'submit': 'firstSearch',\n    },\n    render: function() {\n        this.$el.html(this.template());\n        return this;\n    },\n    showPending: function() {\n        this.$('button').first().text('Searching...');\n        return this;\n    },\n    showIdle: function() {\n        this.$('button').first().text('Search');\n        return this;\n    },\n    submitSearch: function(startRecord) {\n        this.showPending();\n        var myElement = this.el;\n        var searchTerm = this.$('input').val();\n        var searchPromise = GlobalVariables.results.query(\n            {params:{search:searchTerm, source:this.source, startRecord:startRecord},\n            error: function(collection, response, options) {\n                var alert = new AlertView({\n                    level: 'warning',\n                    message: JST['failed-search-message'](response),\n                });\n                alert.render().$el.insertAfter('.page-header');\n                alert.animateIn();\n            },\n        });\n        searchPromise.always(this.showIdle.bind(this));\n        return searchPromise;\n    },\n    firstSearch: function(event){\n        event.preventDefault();\n        this.submitSearch(1).then(_.bind(function() {\n            $('#more-records').show();\n            GlobalVariables.records.reset(GlobalVariables.results.models);\n            if (!document.contains(GlobalVariables.recordsList.$el[0])) {\n                // records list is initialized and rendered but not yet added to DOM\n                GlobalVariables.recordsList.$el.insertAfter($('.page-header'));\n            }\n            this.feedback();\n        }, this));\n    },\n    nextSearch: function(event) {\n        event.preventDefault();\n        $('#more-records').hide();\n        var startRecord = GlobalVariables.records.length+1;\n        this.submitSearch(startRecord).then( _.bind(function() {\n            GlobalVariables.records.add(GlobalVariables.results.models);\n            this.feedback();\n        }, this));\n    },\n    feedback: function() {\n        if (GlobalVariables.records.length === GlobalVariables.results.total_results) {\n            GlobalVariables.records.trigger('complete');\n        } else {\n            $('#more-records').show();\n        }\n        $('#search-feedback').text(\"Showing \" + GlobalVariables.records.length + \" of \" + GlobalVariables.results.total_results + \" results\");\n    },\n    fill: function(fillText) {\n        this.$('#query-input').val(fillText);\n    },\n});\n\nexport var AdvancedSearchView = LazyTemplateView.extend({\n    templateName: 'hpb-search-info',\n    events: {\n        'click a': 'fill',\n    },\n    render: function() {\n        $('#search-info').show();\n        $('#search-info').popover({\n            'html': true, \n            'content': this.$el.html(this.template()), \n            'container': 'body', \n            'placement': 'left'\n        });\n    },\n    fill: function(event) {\n        event.preventDefault();\n        var fillIn = event.target.textContent.slice(0, -9);\n        this.trigger('fill', fillIn);\n    },\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\nimport { FlatAnnotations } from '../annotation/annotation.model';\nimport { RecordFieldsView, RecordAnnotationsView } from '../field/record.field.view';\nimport { FlatFields } from '../field/field.model';\nimport { VRECollectionView } from '../collection/collection.view';\nimport { myCollections } from '../globals/myCollections';\nimport { GlobalVariables } from '../globals/variables';\n\nexport var RecordDetailView = LazyTemplateView.extend({\n    el: '#result_detail',\n    templateName: 'item-fields',\n    events: {\n        'click #load_next': 'load',\n        'click #load_previous': 'load',\n    },\n    initialize: function(options) {\n        this.$title = this.$('.modal-title');\n        this.$body = this.$('.modal-body');\n        this.$footer = this.$('.modal-footer');\n        this.vreCollectionsSelect = new VRECollectionView({collection: myCollections});\n    },\n    setModel: function(model) {\n        if (this.model) {\n            if (this.model === model) return this;\n            this.annotationsView.remove().off();\n            this.fieldsView.remove().off();\n        }\n        this.model = model;\n        this.fieldsView = new RecordFieldsView({\n            collection: new FlatFields(null, {record: model}),\n        });\n        this.annotationsView = new RecordAnnotationsView({\n            collection: new FlatAnnotations(null, {record: model}),\n        });\n        this.vreCollectionsSelect.clear().setRecord(model);\n        this.annotationsView.listenTo(this.fieldsView, 'edit', this.annotationsView.edit);\n        var uriText = this.model.get('uri');\n        this.$title.text(uriText);\n        document.getElementById(\"uri-link\").href = uriText;\n        this.fieldsView.render().$el.appendTo(this.$body);\n        this.annotationsView.render().$el.appendTo(this.$body);\n        return this;\n    },\n    render: function() {\n        this.$footer.prepend(this.vreCollectionsSelect.render().$el);\n        this.$el.modal('show');\n        return this;\n    },\n    load: function(event) {\n        var currentIndex = GlobalVariables.recordsList.collection.findIndex(this.model);\n        var nextIndex = event.target.id==='load_next'? currentIndex+1 : currentIndex-1;\n        var nextModel = GlobalVariables.recordsList.collection.at(nextIndex);\n        this.setModel(nextModel);\n        this.render();\n    },\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\nimport { GlobalVariables } from '../globals/variables';\n\n/**\n * Common base for views that provide behaviour revolving around a\n * single checkbox. When deriving a subclass, bind the `toggle`\n * method to the right checkbox and set `this.$checkbox` in the\n * `render` method.\n */\nexport var SelectableView = LazyTemplateView.extend({\n    toggle: function(event) {\n        // The assignment in the if condition is on purpose (assign + check).\n        if (this.selected = event.target.checked) {\n            this.trigger('check');\n        } else {\n            this.trigger('uncheck');\n        }\n    },\n    check: function() {\n        this.$checkbox.prop('checked', true);\n        this.selected = true;\n        return this;\n    },\n    uncheck: function() {\n        this.$checkbox.prop('checked', false);\n        this.selected = false;\n        return this;\n    },\n});\n\nexport var SelectAllView = SelectableView.extend({\n    className: 'checkbox',\n    templateName: 'select-all-view',\n    events: {\n        'change input': 'toggle',\n    },\n    render: function() {\n        this.$el.html(this.template({}));\n        this.$checkbox = this.$('input');\n        return this;\n    },\n});\n\nexport var RecordListItemView = SelectableView.extend({\n    tagName: 'tr',\n    templateName: 'record-list-item',\n    events: {\n        'change input': 'toggle',\n        'click a': 'display',\n    },\n    render: function() {\n        this.$el.html(this.template(this.model.attributes));\n        this.$checkbox = this.$('input');\n        return this;\n    },\n    display: function(event) {\n        GlobalVariables.recordDetailModal.setModel(this.model).render();\n    },\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\nimport { VRECollectionView } from '../collection/collection.view';\nimport { SelectAllView, RecordListItemView } from './record.list.item.view';\nimport { myCollections } from '../globals/myCollections';\nimport { GlobalVariables } from '../globals/variables';\n\nexport var RecordListView = LazyTemplateView.extend({\n    tagName: 'form',\n    templateName: 'record-list',\n    events: {\n        'submit': function(event) {\n            this.vreCollectionsSelect.submitForm(event);\n        },\n        'click #more-records': 'loadMore',\n    },\n    initialize: function(options) {\n        this.items = [];\n        this.checkedCount = 0;\n        this.listenTo(this.collection, {\n            add: this.addItem,\n            reset: this.render,\n            complete: this.showSelectAll,\n        });\n        this.vreCollectionsSelect = new VRECollectionView({collection: myCollections});\n    },\n    render: function() {\n        this.$el.html(this.template({}));\n        this.$tbody = this.$('tbody');\n        this.renderItems();\n        $('#HPB-info').hide();\n        this.vreCollectionsSelect.render();\n        this.$el.prepend(this.vreCollectionsSelect.$el);\n        return this;\n    },\n    renderItems: function() {\n        this.$tbody.empty();\n        this.collection.forEach(this.addItem.bind(this));\n        return this;\n    },\n    addItem: function(model, collection, options) {\n        var item = new RecordListItemView({model: model});\n        item.on({check: this.checkOne, uncheck: this.uncheckOne}, this);\n        var index;\n        if (options && (index = options.index) != null && index !== this.items.length) {\n            // Insert at the front or in the middle.\n            this.items.splice(index, 0, item);\n            this.$('tr').eq(index).before(item.render().el);\n        } else {\n            // Append at the back.\n            this.items.push(item);\n            this.$tbody.append(item.render().el);\n        }\n        return this;\n    },\n    loadMore: function(event) {\n        GlobalVariables.searchView.nextSearch(event);\n    },\n    showSelectAll: function() {\n        var selectAllView = this.selectAllView = new SelectAllView();\n        this.$('table').before(selectAllView.render().el);\n        selectAllView.on({\n            check: this.checkAll,\n            uncheck: this.uncheckAll,\n        }, this).listenTo(this, {\n            allChecked: selectAllView.check,\n            notAllChecked: selectAllView.uncheck,\n        });\n    },\n    checkOne: function() {\n        if (++this.checkedCount === this.collection.length) {\n            this.trigger('allChecked');\n        }\n        return this;\n    },\n    uncheckOne: function() {\n        --this.checkedCount;\n        this.trigger('notAllChecked');\n        return this;\n    },\n    checkAll: function() {\n        this.checkedCount = this.collection.length;\n        _.invokeMap(this.items, 'check');\n        return this;\n    },\n    uncheckAll: function() {\n        this.checkedCount = 0;\n        _.invokeMap(this.items, 'uncheck');\n        return this;\n    },\n});\n","import { APIModel, APICollection } from '../utils/api.model';\nimport{ Annotations } from '../annotation/annotation.model';\n\nexport var Record = APIModel.extend({\n    urlRoot: '/vre/api/records',\n    getAnnotations: function() {\n        if (!this.annotations) {\n            this.annotations = new Annotations();\n            if (!this.isNew()) this.annotations.query({\n                params: {record__id: this.id}\n            });\n        }\n        return this.annotations;\n    },\n});\n\nexport var Records = APICollection.extend({\n    url: '/vre/api/records',\n    model: Record,\n});","import { LazyTemplateView } from '../utils/lazy.template.view';\n\nexport var SelectSourceView = LazyTemplateView.extend({\n    templateName: 'nav-dropdown',\n    tagName: 'li',\n    className: 'dropdown',\n    initialize: function() {\n        this.render();\n    },\n    render: function() {\n        var collections = {'collections': this.collection.toJSON()};\n        this.$el.html(this.template(collections));\n    },\n});","import Backbone from 'backbone';\nimport { objectAsUrlParams } from './generic-functions';\n\n/**\n * Generic subclass that appends a slash to the model URL.\n * This is required for interop with Django REST Framework.\n */\nexport var APIModel = Backbone.Model.extend({\n    url: function() {\n        return Backbone.Model.prototype.url.call(this) + '/';\n    },\n});\n\n/**\n * Generic subclass that supports filtering at the backend.\n */\nexport var APICollection = Backbone.Collection.extend({\n    model: APIModel,\n    query: function(options) {\n        var url = options.url || this.url;\n        var urlParts = [url, '?'];\n        if (options.params) {\n            urlParts.push(objectAsUrlParams(options.params));\n        }\n        var fetchOptions = _(options).omit(['params']).extend({\n            url: urlParts.join(''),\n        }).value();\n        return this.fetch(fetchOptions);\n    },\n});","import _ from 'lodash';\nimport Cookies from 'jscookie';\n\n/**\n * Perform the following transformation:\n * (from)  {foo: 'bar', foobar: 'baz'}\n * (to)    'foo=bar&foobar=baz'\n */\nexport function objectAsUrlParams(object) {\n    return _(object).entries().invokeMap('join', '=').join('&');\n}\n\nexport function addCSRFToken(ajaxOptions) {\n    return _.defaultsDeep({\n        headers: {'X-CSRFToken': Cookies.get('csrftoken')},\n    }, ajaxOptions);\n}\n\nexport function canonicalSort(key) {\n    var index = (canonicalOrder[key] || 100);\n    return index;\n}\n\nvar canonicalOrder = {\n    'Title': 1,\n    'Uniform Title': 4,\n    'Varying Form of Title': 5,\n    'Author': 8,\n    'Collaborator': 12,\n    'Production': 16,\n    'Publisher': 20,\n    'Added Entry - Corporate Name': 24,\n    'Extent': 28,\n    'Language': 32,\n    'Citation/Reference': 36,\n    'Location of Originals': 40,\n    'Note': 44,\n    'With Note': 48,\n    'Subject Headings': 52,\n};","import Backbone from 'backbone';\nimport { JST } from '../globals/templates';\n\n/**\n * Intermediate class to enable lazy loading of templates.\n * `JST` is uninitialized at the time of extension, so postpone fetching\n * the template until it's needed.\n */\nexport var LazyTemplateView = Backbone.View.extend({\n    template: function(context) {\n        this.template = JST[this.templateName];\n        return this.template(context);\n    },\n});"]}